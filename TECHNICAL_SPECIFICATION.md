# üì± –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è WhisperKit –¥–ª—è real-time —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 18 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:** iOS (Swift UIKit)  
**–¶–µ–ª–µ–≤–∞—è –≤–µ—Ä—Å–∏—è iOS:** 16.0+  

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#1-–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#2-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
3. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è](#3-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Ä–µ—à–µ–Ω–∏—è)
4. [–î–µ—Ç–∞–ª—å–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤](#4-–¥–µ—Ç–∞–ª—å–Ω–∞—è-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
5. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è WhisperKit](#5-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-whisperkit)
6. [Real-time —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è](#6-real-time-—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è)
7. [–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤](#7-–æ–±—Ä–∞–±–æ—Ç–∫–∞-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
8. [–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è](#8-–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ-—è–∑—ã–∫–∞-–∏-–≤–∞–ª–∏–¥–∞—Ü–∏—è)
9. [Retry –º–µ—Ö–∞–Ω–∏–∑–º](#9-retry-–º–µ—Ö–∞–Ω–∏–∑–º)
10. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#10-–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
11. [Best Practices](#11-best-practices)
12. [–ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞](#12-–ø—Ä–∏–º–µ—Ä—ã-–∫–æ–¥–∞)
13. [–ß–µ–∫-–ª–∏—Å—Ç –∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏](#13-—á–µ–∫-–ª–∏—Å—Ç-–∏-–∫—Ä–∏—Ç–µ—Ä–∏–∏-–ø—Ä–∏–µ–º–∫–∏)

---

## 1. –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

### 1.1. –¶–µ–ª—å

–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å iOS-–º–æ–¥—É–ª—å –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (speech-to-text) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ **WhisperKit**, —Ä–∞–±–æ—Ç–∞—é—â–µ–π –ø–æ–ª–Ω–æ—Å—Ç—å—é offline —á–µ—Ä–µ–∑ CoreML.

### 1.2. –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **Real-time —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è** —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ **Offline —Ä–∞–±–æ—Ç–∞** ‚Äî –≤—Å–µ –º–æ–¥–µ–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥ Neural Engine** ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ iPhone
- ‚úÖ **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞** ‚Äî —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–æ–π —Ä–µ—á–∏ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏
- ‚úÖ **Retry –º–µ—Ö–∞–Ω–∏–∑–º** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ **–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** ‚Äî –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 1.3. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- **–¢–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫** ‚Äî –º–æ–¥–µ–ª—å `tiny-en` –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ
- **UIKit** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å UIKit, –ù–ï SwiftUI
- **–ë–µ–∑ Combine** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å delegates
- **iOS 16.0+** ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è CoreML –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π

---

## 2. –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 2.1. –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è iOS** | 16.0 |
| **Xcode** | 15.0+ |
| **Swift** | 6.0+ |
| **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞** | iPhone 8+ (A12+ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è Neural Engine) |
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** | UIKit (–±–µ–∑ SwiftUI) |
| **–ü–∞—Ç—Ç–µ—Ä–Ω—ã** | Singleton, Delegate, Async/await, Actors |

### 2.2. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```swift
// Package.swift –∏–ª–∏ SPM –≤ Xcode
dependencies: [
    .package(url: "https://github.com/argmaxinc/WhisperKit.git", from: "0.14.0")
]
```

### 2.3. –†–∞–∑—Ä–µ—à–µ–Ω–∏—è (Info.plist)

```xml
<key>NSMicrophoneUsageDescription</key>
<string>–ú–∏–∫—Ä–æ—Ñ–æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –≤–∞—à–µ–π —Ä–µ—á–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</string>

<key>NSAllowsArbitraryLoads</key>
<false/>
```

---

## 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### 3.1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        TranscriptionViewController (UIKit)          ‚îÇ
‚îÇ  - UI —ç–ª–µ–º–µ–Ω—Ç—ã (UILabel, UIButton, UITextView)     ‚îÇ
‚îÇ  - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö/—Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ
                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         WhisperKitManager (Singleton)               ‚îÇ
‚îÇ  - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WhisperKit                         ‚îÇ
‚îÇ  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—è–º–∏                               ‚îÇ
‚îÇ  - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ                       ‚îÇ
           ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ AudioRecordingManager‚îÇ   ‚îÇ ModelDownloadManager     ‚îÇ
‚îÇ - AVAudioEngine      ‚îÇ   ‚îÇ - –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏      ‚îÇ
‚îÇ - Buffer processing  ‚îÇ   ‚îÇ - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ            ‚îÇ
‚îÇ - Real-time capture  ‚îÇ   ‚îÇ - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        AudioStreamTranscriber (WhisperKit)          ‚îÇ
‚îÇ  - –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –∞—É–¥–∏–æ –ø–æ—Ç–æ–∫–∞            ‚îÇ
‚îÇ  - –ö–æ–ª–±—ç–∫–∏ –¥–ª—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           ErrorHandler + RetryManager               ‚îÇ
‚îÇ  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫                      ‚îÇ
‚îÇ  - Retry —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π               ‚îÇ
‚îÇ  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 3.2. –î–∏–∞–≥—Ä–∞–º–º–∞ –∫–ª–∞—Å—Å–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   WhisperKitManager (Singleton)        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ - whisperKit: WhisperKit?              ‚îÇ
‚îÇ - modelDownloadManager                 ‚îÇ
‚îÇ - retryManager                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ + shared: WhisperKitManager            ‚îÇ
‚îÇ + initialize() async throws            ‚îÇ
‚îÇ + startRealtimeTranscription(delegate) ‚îÇ
‚îÇ + stopTranscription()                  ‚îÇ
‚îÇ + retryWithBackoff(operation)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
                ‚îÇ has-a
                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   ModelDownloadManager                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ - cachedModelPath: URL?                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ + downloadIfNeeded() async throws      ‚îÇ
‚îÇ + checkCachedModel() -> Bool           ‚îÇ
‚îÇ + getCachePath() -> URL                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   AudioRecordingManager                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ - audioEngine: AVAudioEngine           ‚îÇ
‚îÇ - streamTranscriber                    ‚îÇ
‚îÇ - delegate                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ + startRecording() throws              ‚îÇ
‚îÇ + stopRecording()                      ‚îÇ
‚îÇ + processAudioBuffer(buffer)           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   TranscriptionViewController          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ - intermediateLabel: UILabel           ‚îÇ
‚îÇ - finalTextView: UITextView            ‚îÇ
‚îÇ - recordButton: UIButton               ‚îÇ
‚îÇ - statusLabel: UILabel                 ‚îÇ
‚îÇ - whisperManager                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ + viewDidLoad()                        ‚îÇ
‚îÇ + setupUI()                            ‚îÇ
‚îÇ + handleRecordButtonTap()              ‚îÇ
‚îÇ + updateIntermediateResult(text)       ‚îÇ
‚îÇ + updateFinalResult(text)              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   TranscriptionDelegate (Protocol)     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ + didReceiveIntermediateResult(String) ‚îÇ
‚îÇ + didReceiveFinalResult(String)        ‚îÇ
‚îÇ + didEncounterError(Error)             ‚îÇ
‚îÇ + didDetectNonEnglishSpeech()          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   RetryManager                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ - maxRetries: Int = 3                  ‚îÇ
‚îÇ - baseDelay: TimeInterval = 1.0        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ + retry(operation) async throws -> T   ‚îÇ
‚îÇ + exponentialBackoff(attempt) -> Time  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 4. –î–µ—Ç–∞–ª—å–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### 4.1. WhisperKitManager

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** Singleton –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º WhisperKit –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WhisperKit —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª—å—é `tiny-en`
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è real-time —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
- –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ thread-safety

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**

```swift
class WhisperKitManager {
    static let shared = WhisperKitManager()
    
    private var whisperKit: WhisperKit?
    private let modelDownloadManager: ModelDownloadManager
    private let retryManager: RetryManager
    private var audioRecordingManager: AudioRecordingManager?
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –ø–æ–ª–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
    func initialize() async throws
    
    // –ó–∞–ø—É—Å–∫ real-time —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
    func startRealtimeTranscription(delegate: TranscriptionDelegate) throws
    
    // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
    func stopTranscription()
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
    func isReady() -> Bool
}
```

### 4.2. ModelDownloadManager

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ–º –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –º–æ–¥–µ–ª–µ–π WhisperKit.

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–µ–º –≤ Documents/whisperkit_models/
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –º–æ–¥–µ–ª–µ–π

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**

```swift
class ModelDownloadManager {
    private let modelName = "tiny-en"
    
    // –°–∫–∞—á–∞—Ç—å –º–æ–¥–µ–ª—å –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
    func downloadModelIfNeeded() async throws -> URL
    
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
    func hasCachedModel() -> Bool
    
    // –ü–æ–ª—É—á–∏—Ç—å –ø—É—Ç—å –∫ –∫—ç—à—É
    func getCachePath() -> URL
    
    // –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
    func clearCache() throws
}
```

### 4.3. AudioRecordingManager

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—Ö–≤–∞—Ç–æ–º –∞—É–¥–∏–æ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –≤ WhisperKit –¥–ª—è real-time —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏.

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è AVAudioEngine
- –ó–∞—Ö–≤–∞—Ç –∞—É–¥–∏–æ –±—É—Ñ–µ—Ä–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ audio session
- –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö –≤ AudioStreamTranscriber

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**

```swift
class AudioRecordingManager {
    private let audioEngine = AVAudioEngine()
    private var streamTranscriber: AudioStreamTranscriber?
    weak var delegate: TranscriptionDelegate?
    
    // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å audio session
    func setupAudioSession() throws
    
    // –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å
    func startRecording() throws
    
    // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
    func stopRecording()
    
    // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å audio buffer
    func processAudioBuffer(_ buffer: AVAudioPCMBuffer)
}
```

### 4.4. TranscriptionViewController

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** UIKit view controller –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏. - –∏—Å–ø–æ–ª—å–∑—É–π —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π mainviewcontroller –∏ –µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

<!--**UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:** -->

<!--```swift-->
<!--class TranscriptionViewController: UIViewController {-->
<!--    // UI —ç–ª–µ–º–µ–Ω—Ç—ã-->
<!--    private let intermediateLabel: UILabel       // –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã-->
<!--    private let finalTextView: UITextView        // –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç-->
<!--    private let recordButton: UIButton           // –ö–Ω–æ–ø–∫–∞ –∑–∞–ø–∏—Å–∏-->
<!--    private let statusLabel: UILabel             // –°—Ç–∞—Ç—É—Å (–≥–æ—Ç–æ–≤/–∑–∞–ø–∏—Å—å/–æ—à–∏–±–∫–∞)-->
<!--    private let languageWarningView: UIView      // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ —è–∑—ã–∫–µ-->
<!--    -->
<!--    // –ú–µ–Ω–µ–¥–∂–µ—Ä—ã-->
<!--    private let whisperManager = WhisperKitManager.shared-->
<!--    -->
<!--    override func viewDidLoad()-->
<!--    func setupUI()-->
<!--    func setupConstraints()-->
<!--    func handleRecordButtonTap()-->
<!--}-->
<!--```-->

### 4.5. RetryManager

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è retry –º–µ—Ö–∞–Ω–∏–∑–º–∞ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π.

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫: 3
- –ë–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: 1.0 —Å–µ–∫—É–Ω–¥–∞
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç: delay = baseDelay * 2^(attempt - 1)

```swift
class RetryManager {
    let maxRetries = 3
    let baseDelay: TimeInterval = 1.0
    
    func retry<T>(
        operation: @escaping () async throws -> T
    ) async throws -> T
    
    private func calculateBackoff(attempt: Int) -> TimeInterval
}
```

---

## 5. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è WhisperKit

### 5.1. WhisperKitConfig - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ú–æ–¥–µ–ª—å: `tiny-en` (—Ä–∞–∑–º–µ—Ä ~40MB, —Ç–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
- –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ (prewarm) –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ

**–ö–æ–¥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**

```swift
let config = WhisperKitConfig(
    model: "tiny-en",                    // –ú–æ–¥–µ–ª—å –¥–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
    verbose: false,                      // –õ–æ–≥–∏ —Ç–æ–ª—å–∫–æ –≤ debug —Ä–µ–∂–∏–º–µ
    download: true,                      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
    prewarm: true,                      // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
    load: true,                         // –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å —Å—Ä–∞–∑—É
    modelRepo: nil,                     // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    modelFolder: getCachedModelPath()   // –ö—ç—à –≤ Documents
)

let whisperKit = try await WhisperKit(config)
```

**–ü—É—Ç—å –∫ –∫—ç—à—É –º–æ–¥–µ–ª–∏:**

```swift
func getCachedModelPath() -> URL {
    let documentsPath = FileManager.default
        .urls(for: .documentDirectory, in: .userDomainMask)[0]
    return documentsPath
        .appendingPathComponent("whisperkit_models")
        .appendingPathComponent("tiny-en")
}
```

### 5.2. ModelComputeOptions - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥ Neural Engine

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Neural Engine –¥–ª—è iPhone —Å A12+
- Fallback –Ω–∞ CPU –¥–ª—è —Å—Ç–∞—Ä—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è

**–ö–æ–¥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**

```swift
var computeOptions = ModelComputeOptions()

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Neural Engine + GPU –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
computeOptions.audioEncoderCompute = .neuralEngine
computeOptions.textDecoderCompute = .neuralEngine

// –ï—Å–ª–∏ Neural Engine –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, fallback –Ω–∞ CPU
if !isNeuralEngineAvailable() {
    computeOptions.audioEncoderCompute = .cpuAndGPU
    computeOptions.textDecoderCompute = .cpuAndGPU
}

// –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
let whisperKit = try await WhisperKit(
    WhisperKitConfig(
        model: "tiny-en",
        computeOptions: computeOptions
    )
)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Neural Engine:**

```swift
func isNeuralEngineAvailable() -> Bool {
    // Neural Engine –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ A12+ (iPhone XS –∏ –Ω–æ–≤–µ–µ)
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ device identifier
    var systemInfo = utsname()
    uname(&systemInfo)
    let modelCode = withUnsafePointer(to: &systemInfo.machine) {
        $0.withMemoryRebound(to: CChar.self, capacity: 1) {
            String(validatingUTF8: $0)
        }
    }
    
    // iPhone11,2 = iPhone XS (A12) –∏ –≤—ã—à–µ
    // –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
    return true  // –î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è, —Ç–∞–∫ –∫–∞–∫ –º–∏–Ω–∏–º—É–º iOS 16
}
```

### 5.3. DecodingOptions - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –Ø–∑—ã–∫: –∞–Ω–≥–ª–∏–π—Å–∫–∏–π (`en`)
- –ó–∞–¥–∞—á–∞: —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è (`transcribe`)
- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 0.0 (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã)
- –ö–æ–ª–±—ç–∫–∏ –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–ª–æ–≤

**–ö–æ–¥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**

```swift
var decodingOptions = DecodingOptions()

// –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
decodingOptions.language = "en"              // –¢–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
decodingOptions.task = .transcribe           // –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è (–Ω–µ –ø–µ—Ä–µ–≤–æ–¥)
decodingOptions.temperature = 0.0            // –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
decodingOptions.temperatureFallbackCount = 0 // –ë–µ–∑ fallback
decodingOptions.sampleLength = 224           // –î–ª–∏–Ω–∞ –∞—É–¥–∏–æ —Å–µ–≥–º–µ–Ω—Ç–∞

// –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
decodingOptions.wordTimestamps = true        // –ú–µ—Ç–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–ª–æ–≤
decodingOptions.clipTimestamps = [0]         // –ù–∞—á–∞–ª–æ —Å 0 —Å–µ–∫—É–Ω–¥—ã

// –ö–æ–ª–±—ç–∫–∏ –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
decodingOptions.progressCallback = { progress in
    DispatchQueue.main.async {
        // –û–±–Ω–æ–≤–∏—Ç—å UI —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º (0.0 - 1.0)
        self.updateProgress(progress.fractionCompleted)
    }
}

decodingOptions.segmentCallback = { segments in
    DispatchQueue.main.async {
        // –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        let intermediateText = segments.map { $0.text }.joined()
        self.updateIntermediateResult(intermediateText)
    }
}

// –î–µ—Ç–µ–∫—Ü–∏—è –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–æ–≤ (–¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è)
decodingOptions.detectLanguage = true        // –í–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–µ–∫—Ü–∏—é
```

### 5.4. –°—Ç—Ä–∞—Ç–µ–≥–∏—è —á–∞–Ω–∫–∏–Ω–≥–∞ (Chunking)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–µ—Ç–µ–∫—Ü–∏—è —á–∞–Ω–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ VAD (Voice Activity Detection)
- –†–∞–∑–º–µ—Ä —á–∞–Ω–∫–∞: ~30 —Å–µ–∫—É–Ω–¥ (–¥–µ—Ñ–æ–ª—Ç WhisperKit)
- Overlap –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**

```swift
// WhisperKit –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —á–∞–Ω–∫–∏–Ω–≥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ AudioStreamTranscriber

let streamTranscriber = AudioStreamTranscriber(
    audioProcessor: whisperKit.audioProcessor,
    transcriber: whisperKit,
    decodingOptions: decodingOptions
)

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—Ç–æ–∫–∞
streamTranscriber.transcribeChunk = { audioBuffer in
    // WhisperKit –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã —á–∞–Ω–∫–æ–≤
    // –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–µ—Ç–µ–∫—Ü–∏–∏ –≥–æ–ª–æ—Å–∞ (VAD)
    return try await whisperKit.transcribe(
        audioArray: audioBuffer,
        decodeOptions: decodingOptions
    )
}
```

---

## 6. Real-time —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è

### 6.1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ AudioStreamTranscriber

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**

```
–ú–∏–∫—Ä–æ—Ñ–æ–Ω ‚Üí AVAudioEngine ‚Üí Audio Buffer ‚Üí 
AudioStreamTranscriber ‚Üí WhisperKit ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí 
–ö–æ–ª–±—ç–∫–∏ ‚Üí UI Update
```

### 6.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AVAudioEngine

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –§–æ—Ä–º–∞—Ç: 16000 Hz, –º–æ–Ω–æ, Float32
- –†–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞: –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –¥–ª—è real-time
- Audio session category: `.record`

**–ö–æ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**

```swift
class AudioRecordingManager {
    private let audioEngine = AVAudioEngine()
    private var streamTranscriber: AudioStreamTranscriber?
    private let targetSampleRate: Double = 16000  // WhisperKit —Ç—Ä–µ–±—É–µ—Ç 16kHz
    
    func setupAudioSession() throws {
        let audioSession = AVAudioSession.sharedInstance()
        try audioSession.setCategory(
            .record,
            mode: .measurement,
            options: []
        )
        try audioSession.setActive(true)
    }
    
    func startRecording(
        whisperKit: WhisperKit,
        decodingOptions: DecodingOptions,
        delegate: TranscriptionDelegate
    ) throws {
        // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å audio session
        try setupAudioSession()
        
        // –°–æ–∑–¥–∞—Ç—å AudioStreamTranscriber
        self.streamTranscriber = AudioStreamTranscriber(
            audioProcessor: whisperKit.audioProcessor,
            transcriber: whisperKit,
            decodingOptions: decodingOptions
        )
        
        // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–ª–±—ç–∫–∏
        setupCallbacks(delegate: delegate)
        
        // –ù–∞—á–∞—Ç—å –∑–∞—Ö–≤–∞—Ç –∞—É–¥–∏–æ
        let inputNode = audioEngine.inputNode
        let inputFormat = inputNode.outputFormat(forBus: 0)
        
        // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å tap –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ –±—É—Ñ–µ—Ä–æ–≤
        inputNode.installTap(
            onBus: 0,
            bufferSize: 4096,
            format: inputFormat
        ) { [weak self] buffer, time in
            self?.processAudioBuffer(buffer)
        }
        
        // –ó–∞–ø—É—Å—Ç–∏—Ç—å audio engine
        audioEngine.prepare()
        try audioEngine.start()
    }
    
    func stopRecording() {
        audioEngine.stop()
        audioEngine.inputNode.removeTap(onBus: 0)
        streamTranscriber?.stopTranscription()
    }
    
    private func processAudioBuffer(_ buffer: AVAudioPCMBuffer) {
        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Float array
        guard let channelData = buffer.floatChannelData else { return }
        let frameLength = Int(buffer.frameLength)
        let samples = Array(
            UnsafeBufferPointer(
                start: channelData[0],
                count: frameLength
            )
        )
        
        // –†–µ—Å–µ–º–ø–ª–∏—Ä–æ–≤–∞—Ç—å –¥–æ 16kHz –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        let resampledSamples = resampleIfNeeded(
            samples,
            from: buffer.format.sampleRate,
            to: targetSampleRate
        )
        
        // –ü–µ—Ä–µ–¥–∞—Ç—å –≤ AudioStreamTranscriber
        Task {
            await streamTranscriber?.processAudioSamples(resampledSamples)
        }
    }
    
    private func resampleIfNeeded(
        _ samples: [Float],
        from sourceRate: Double,
        to targetRate: Double
    ) -> [Float] {
        guard sourceRate != targetRate else { return samples }
        
        // –ü—Ä–æ—Å—Ç–æ–π linear resampling
        // –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ vDSP –∏–ª–∏ Accelerate framework
        let ratio = sourceRate / targetRate
        let newLength = Int(Double(samples.count) / ratio)
        var resampled: [Float] = []
        
        for i in 0..<newLength {
            let sourceIndex = Int(Double(i) * ratio)
            if sourceIndex < samples.count {
                resampled.append(samples[sourceIndex])
            }
        }
        
        return resampled
    }
}
```

### 6.3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–ª–±—ç–∫–æ–≤

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ü—Ä–æ–≥—Ä–µ—Å—Å –∫–æ–ª–±—ç–∫: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –°–µ–≥–º–µ–Ω—Ç –∫–æ–ª–±—ç–∫: –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –í—Å–µ UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ main thread

**–ö–æ–¥ –∫–æ–ª–±—ç–∫–æ–≤:**

```swift
extension AudioRecordingManager {
    private func setupCallbacks(delegate: TranscriptionDelegate) {
        // –ö–æ–ª–±—ç–∫ –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
        streamTranscriber?.onProgress = { progress in
            DispatchQueue.main.async {
                // progress.fractionCompleted: 0.0 - 1.0
                delegate.didUpdateProgress(progress.fractionCompleted)
            }
        }
        
        // –ö–æ–ª–±—ç–∫ –¥–ª—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤
        streamTranscriber?.onSegmentReceived = { segments in
            DispatchQueue.main.async {
                let intermediateText = segments
                    .map { $0.text }
                    .joined(separator: " ")
                delegate.didReceiveIntermediateResult(intermediateText)
            }
        }
        
        // –ö–æ–ª–±—ç–∫ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        streamTranscriber?.onTranscriptionComplete = { result in
            DispatchQueue.main.async {
                if let finalText = result?.text {
                    delegate.didReceiveFinalResult(finalText)
                }
            }
        }
        
        // –ö–æ–ª–±—ç–∫ –¥–ª—è –æ—à–∏–±–æ–∫
        streamTranscriber?.onError = { error in
            DispatchQueue.main.async {
                delegate.didEncounterError(error)
            }
        }
    }
}
```

---

## 7. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### 7.1. –¢–∏–ø—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**WhisperKit –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**

```swift
struct TranscriptionResult {
    let text: String                    // –í–µ—Å—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
    let segments: [TranscriptionSegment] // –°–µ–≥–º–µ–Ω—Ç—ã —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏
    let language: String                // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —è–∑—ã–∫
    let languageLogProbs: [String: Float] // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —è–∑—ã–∫–æ–≤
}

struct TranscriptionSegment {
    let id: Int
    let text: String
    let start: Double                   // –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ (—Å–µ–∫—É–Ω–¥—ã)
    let end: Double                     // –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è (—Å–µ–∫—É–Ω–¥—ã)
    let tokens: [Int]
    let temperature: Float
    let avgLogprob: Float
    let compressionRatio: Float
    let noSpeechProb: Float
    let words: [WordTiming]?            // –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω wordTimestamps
}

struct WordTiming {
    let word: String
    let start: Double
    let end: Double
    let probability: Float
}
```

### 7.2. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:**

```swift
class TranscriptionViewController: UIViewController {
    // –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–ø–æ –º–µ—Ä–µ –≥–æ–≤–æ—Ä–µ–Ω–∏—è)
    private let intermediateLabel: UILabel = {
        let label = UILabel()
        label.numberOfLines = 0
        label.font = .systemFont(ofSize: 16, weight: .regular)
        label.textColor = .secondaryLabel
        label.text = "–ù–∞—á–Ω–∏—Ç–µ –≥–æ–≤–æ—Ä–∏—Ç—å..."
        return label
    }()
    
    // –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç (–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã)
    private let finalTextView: UITextView = {
        let textView = UITextView()
        textView.font = .systemFont(ofSize: 18, weight: .medium)
        textView.textColor = .label
        textView.isEditable = false
        textView.backgroundColor = .systemGray6
        textView.layer.cornerRadius = 12
        return textView
    }()
    
    // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    private let progressView: UIProgressView = {
        let progress = UIProgressView(progressViewStyle: .default)
        progress.progress = 0.0
        return progress
    }()
}

// MARK: - TranscriptionDelegate
extension TranscriptionViewController: TranscriptionDelegate {
    func didReceiveIntermediateResult(_ text: String) {
        // –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (—Å–µ—Ä—ã–º —Ü–≤–µ—Ç–æ–º)
        intermediateLabel.text = text
        intermediateLabel.alpha = 0.7
    }
    
    func didReceiveFinalResult(_ text: String) {
        // –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        let currentText = finalTextView.text ?? ""
        let newText = currentText.isEmpty ? text : "\(currentText)\n\n\(text)"
        finalTextView.text = newText
        
        // –û—á–∏—Å—Ç–∏—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        intermediateLabel.text = ""
        
        // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –≤–Ω–∏–∑
        let bottom = NSRange(location: finalTextView.text.count - 1, length: 1)
        finalTextView.scrollRangeToVisible(bottom)
    }
    
    func didUpdateProgress(_ progress: Float) {
        progressView.progress = progress
    }
    
    func didEncounterError(_ error: Error) {
        showErrorAlert(error)
    }
    
    func didDetectNonEnglishSpeech() {
        showLanguageWarning()
    }
}
```

### 7.3. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

```swift
func formatResultWithTimestamps(_ result: TranscriptionResult) -> String {
    var formatted = ""
    
    for segment in result.segments {
        let startTime = formatTime(segment.start)
        let endTime = formatTime(segment.end)
        formatted += "[\(startTime) - \(endTime)] \(segment.text)\n"
    }
    
    return formatted
}

func formatTime(_ seconds: Double) -> String {
    let minutes = Int(seconds) / 60
    let secs = Int(seconds) % 60
    return String(format: "%02d:%02d", minutes, secs)
}

// –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
// [00:00 - 00:03] Hello world
// [00:03 - 00:06] This is a test
```

---

## 8. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### 8.1. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- ‚úÖ –ú–æ–¥–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π (`tiny-en`)
- ‚úÖ –ü—Ä–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ –¥—Ä—É–≥–æ–≥–æ —è–∑—ã–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
- ‚úÖ –ù–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é, –Ω–æ —É–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `languageLogProbs` –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏

### 8.2. –î–µ—Ç–µ–∫—Ü–∏—è –Ω–µ–∞–Ω–≥–ª–∏–π—Å–∫–æ–π —Ä–µ—á–∏

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

```swift
class LanguageDetector {
    // –ü–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
    private let englishConfidenceThreshold: Float = 0.7
    
    func isEnglishSpeech(result: TranscriptionResult) -> Bool {
        guard let englishProb = result.languageLogProbs["en"] else {
            return false
        }
        
        // Log probability –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å
        let probability = exp(englishProb)
        
        return probability >= englishConfidenceThreshold
    }
    
    func getMostLikelyLanguage(result: TranscriptionResult) -> String {
        let sorted = result.languageLogProbs.sorted { $0.value > $1.value }
        return sorted.first?.key ?? "unknown"
    }
}
```

### 8.3. UI –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

**–ê–ª–µ—Ä—Ç –ø—Ä–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ –Ω–µ–∞–Ω–≥–ª–∏–π—Å–∫–æ–π —Ä–µ—á–∏:**

```swift
extension TranscriptionViewController {
    func showLanguageWarning() {
        let alert = UIAlertController(
            title: "English Only",
            message: "Please speak English. This model is optimized for English language only.",
            preferredStyle: .alert
        )
        
        alert.addAction(UIAlertAction(
            title: "OK",
            style: .default
        ))
        
        // –î–æ–±–∞–≤–∏—Ç—å haptic feedback
        let generator = UINotificationFeedbackGenerator()
        generator.notificationOccurred(.warning)
        
        present(alert, animated: true)
    }
    
    // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –±–∞–Ω–Ω–µ—Ä –≤–º–µ—Å—Ç–æ –∞–ª–µ—Ä—Ç–∞
    func showLanguageWarningBanner() {
        let warningView = UIView()
        warningView.backgroundColor = .systemOrange
        warningView.layer.cornerRadius = 8
        
        let label = UILabel()
        label.text = "‚ö†Ô∏è Please speak English"
        label.textColor = .white
        label.font = .systemFont(ofSize: 14, weight: .semibold)
        
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
        UIView.animate(withDuration: 0.3, animations: {
            warningView.alpha = 1.0
        }, completion: { _ in
            UIView.animate(withDuration: 0.3, delay: 2.0, options: [], animations: {
                warningView.alpha = 0.0
            })
        })
    }
}
```

### 8.4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø–æ—Ç–æ–∫ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏

```swift
extension AudioRecordingManager {
    private func setupCallbacks(delegate: TranscriptionDelegate) {
        streamTranscriber?.onTranscriptionComplete = { result in
            DispatchQueue.main.async {
                guard let result = result else { return }
                
                // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —è–∑—ã–∫
                let detector = LanguageDetector()
                if !detector.isEnglishSpeech(result: result) {
                    delegate.didDetectNonEnglishSpeech()
                }
                
                // –í—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                delegate.didReceiveFinalResult(result.text)
            }
        }
    }
}
```

---

## 9. Retry –º–µ—Ö–∞–Ω–∏–∑–º

### 9.1. –¢–∏–ø—ã –æ—à–∏–±–æ–∫ —Ç—Ä–µ–±—É—é—â–∏—Ö retry

1. **Network errors** - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
2. **Model loading failures** - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–∞–º—è—Ç—å—é
3. **Transcription errors** - –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–±–æ–∏ CoreML
4. **Audio processing errors** - –ø—Ä–æ–±–ª–µ–º—ã —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–º

### 9.2. –°—Ç—Ä–∞—Ç–µ–≥–∏—è retry

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫: **3**
- –ë–∞–∑–æ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: **1.0 —Å–µ–∫—É–Ω–¥–∞**
- –≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π backoff: `delay = baseDelay * 2^(attempt - 1)`
  - –ü–æ–ø—ã—Ç–∫–∞ 1: –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
  - –ü–æ–ø—ã—Ç–∫–∞ 2: —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
  - –ü–æ–ø—ã—Ç–∫–∞ 3: —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
  - –ü–æ–ø—ã—Ç–∫–∞ 4: —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã (–Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ maxRetries = 3)

### 9.3. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è RetryManager

```swift
class RetryManager {
    let maxRetries: Int
    let baseDelay: TimeInterval
    
    init(maxRetries: Int = 3, baseDelay: TimeInterval = 1.0) {
        self.maxRetries = maxRetries
        self.baseDelay = baseDelay
    }
    
    /// –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø–æ–≤—Ç–æ—Ä–∞–º–∏
    func retry<T>(
        operation: @escaping () async throws -> T
    ) async throws -> T {
        var lastError: Error?
        
        for attempt in 0..<maxRetries {
            do {
                // –ü–æ–ø—ã—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
                return try await operation()
            } catch {
                lastError = error
                
                // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
                print("‚ö†Ô∏è Attempt \(attempt + 1) failed: \(error.localizedDescription)")
                
                // –ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞, –ø—Ä–æ–∫–∏–Ω—É—Ç—å –æ—à–∏–±–∫—É
                if attempt == maxRetries - 1 {
                    throw error
                }
                
                // –í—ã—á–∏—Å–ª–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É
                let delay = calculateBackoff(attempt: attempt + 1)
                print("‚è≥ Retrying in \(delay) seconds...")
                
                // –ü–æ–¥–æ–∂–¥–∞—Ç—å –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–æ–π
                try await Task.sleep(nanoseconds: UInt64(delay * 1_000_000_000))
            }
        }
        
        // –ù–µ –¥–æ–ª–∂–Ω–æ —Å—é–¥–∞ –ø–æ–ø–∞–¥–∞—Ç—å, –Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        throw lastError ?? NSError(
            domain: "RetryManager",
            code: -1,
            userInfo: [NSLocalizedDescriptionKey: "All retries failed"]
        )
    }
    
    /// –í—ã—á–∏—Å–ª–∏—Ç—å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É
    private func calculateBackoff(attempt: Int) -> TimeInterval {
        return baseDelay * pow(2.0, Double(attempt - 1))
    }
}
```

### 9.4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ retry

**–ü—Ä–∏–º–µ—Ä: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å retry**

```swift
class WhisperKitManager {
    private let retryManager = RetryManager(maxRetries: 3, baseDelay: 1.0)
    
    func initialize() async throws {
        try await retryManager.retry {
            // –°–∫–∞—á–∞—Ç—å –º–æ–¥–µ–ª—å (–º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å –∏–∑-–∑–∞ —Å–µ—Ç–∏)
            try await modelDownloadManager.downloadModelIfNeeded()
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å WhisperKit (–º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å –∏–∑-–∑–∞ –ø–∞–º—è—Ç–∏)
            let config = WhisperKitConfig(model: "tiny-en")
            self.whisperKit = try await WhisperKit(config)
            
            print("‚úÖ WhisperKit initialized successfully")
        }
    }
}
```

**–ü—Ä–∏–º–µ—Ä: –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Å retry**

```swift
func transcribeWithRetry(audioPath: String) async throws -> TranscriptionResult? {
    return try await retryManager.retry {
        guard let whisperKit = self.whisperKit else {
            throw WhisperKitError.notInitialized
        }
        
        return try await whisperKit.transcribe(audioPath: audioPath)
    }
}
```

### 9.5. UI –∏–Ω–¥–∏–∫–∞—Ü–∏—è retry

```swift
extension TranscriptionViewController {
    func showRetryIndicator(attempt: Int, maxAttempts: Int) {
        statusLabel.text = "Retry \(attempt)/\(maxAttempts)..."
        statusLabel.textColor = .systemOrange
        
        // Haptic feedback
        let generator = UIImpactFeedbackGenerator(style: .medium)
        generator.impactOccurred()
    }
}
```

---

## 10. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### 10.1. –¢–∏–ø—ã –æ—à–∏–±–æ–∫ WhisperKit

```swift
enum WhisperKitError: Error {
    case notInitialized
    case modelNotFound
    case modelDownloadFailed(underlying: Error)
    case modelLoadingFailed(underlying: Error)
    case audioProcessingFailed(underlying: Error)
    case transcriptionFailed(underlying: Error)
    case microphonePermissionDenied
    case audioSessionFailed(underlying: Error)
    case insufficientMemory
    case unsupportedDevice
    case networkError(underlying: Error)
    case unknown(underlying: Error)
}
```

### 10.2. –ú–∞–ø–ø–∏–Ω–≥ –æ—à–∏–±–æ–∫ –Ω–∞ UI —Å–æ–æ–±—â–µ–Ω–∏—è

```swift
extension WhisperKitError {
    var userFriendlyMessage: String {
        switch self {
        case .notInitialized:
            return "WhisperKit –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ."
            
        case .modelNotFound:
            return "–ú–æ–¥–µ–ª—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É."
            
        case .modelDownloadFailed:
            return "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å –º–æ–¥–µ–ª—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
            
        case .modelLoadingFailed:
            return "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ."
            
        case .audioProcessingFailed:
            return "–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—É–¥–∏–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞."
            
        case .transcriptionFailed:
            return "–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ä–µ—á—å. –ì–æ–≤–æ—Ä–∏—Ç–µ —á—ë—Ç—á–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
            
        case .microphonePermissionDenied:
            return "–î–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É –∑–∞–ø—Ä–µ—â–µ–Ω. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö iOS."
            
        case .audioSessionFailed:
            return "–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞—É–¥–∏–æ. –ó–∞–∫—Ä–æ–π—Ç–µ –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –º–∏–∫—Ä–æ—Ñ–æ–Ω."
            
        case .insufficientMemory:
            return "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏. –ó–∞–∫—Ä–æ–π—Ç–µ –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
            
        case .unsupportedDevice:
            return "–í–∞—à–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è. –¢—Ä–µ–±—É–µ—Ç—Å—è iOS 16.0 –∏–ª–∏ –≤—ã—à–µ."
            
        case .networkError:
            return "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É."
            
        case .unknown:
            return "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ."
        }
    }
    
    var recoveryAction: String {
        switch self {
        case .microphonePermissionDenied:
            return "–û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"
        case .modelDownloadFailed, .networkError:
            return "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å"
        case .insufficientMemory:
            return "–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
        default:
            return "OK"
        }
    }
}
```

### 10.3. –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫

```swift
class ErrorHandler {
    weak var viewController: UIViewController?
    
    func handle(_ error: Error) {
        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ WhisperKitError
        let whisperError: WhisperKitError
        
        if let wkError = error as? WhisperKitError {
            whisperError = wkError
        } else {
            whisperError = .unknown(underlying: error)
        }
        
        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        logError(whisperError)
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∞–ª–µ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        showErrorAlert(whisperError)
        
        // –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        trackError(whisperError)
    }
    
    private func logError(_ error: WhisperKitError) {
        print("‚ùå Error: \(error)")
        print("   Message: \(error.userFriendlyMessage)")
        
        // –í production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        // –Ω–∞–ø—Ä–∏–º–µ—Ä: OSLog, CocoaLumberjack, –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫—É –≤ —Å–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
    }
    
    private func showErrorAlert(_ error: WhisperKitError) {
        DispatchQueue.main.async { [weak self] in
            guard let viewController = self?.viewController else { return }
            
            let alert = UIAlertController(
                title: "–û—à–∏–±–∫–∞",
                message: error.userFriendlyMessage,
                preferredStyle: .alert
            )
            
            // –û—Å–Ω–æ–≤–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ
            let primaryAction = UIAlertAction(
                title: error.recoveryAction,
                style: .default
            ) { _ in
                self?.handleRecoveryAction(for: error)
            }
            alert.addAction(primaryAction)
            
            // –û—Ç–º–µ–Ω–∞
            if error.recoveryAction != "OK" {
                alert.addAction(UIAlertAction(
                    title: "–û—Ç–º–µ–Ω–∞",
                    style: .cancel
                ))
            }
            
            viewController.present(alert, animated: true)
            
            // Haptic feedback
            let generator = UINotificationFeedbackGenerator()
            generator.notificationOccurred(.error)
        }
    }
    
    private func handleRecoveryAction(for error: WhisperKitError) {
        switch error {
        case .microphonePermissionDenied:
            openAppSettings()
            
        case .modelDownloadFailed, .networkError:
            retryOperation()
            
        default:
            break
        }
    }
    
    private func openAppSettings() {
        if let url = URL(string: UIApplication.openSettingsURLString) {
            UIApplication.shared.open(url)
        }
    }
    
    private func retryOperation() {
        // –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –æ–ø–µ—Ä–∞—Ü–∏—é
        // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    }
    
    private func trackError(_ error: WhisperKitError) {
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É (Firebase, Amplitude, etc.)
        // Analytics.logEvent("whisperkit_error", parameters: [...])
    }
}
```

### 10.4. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω:**

```swift
func checkMicrophonePermission() async throws {
    let status = AVAudioSession.sharedInstance().recordPermission
    
    switch status {
    case .granted:
        return
        
    case .denied:
        throw WhisperKitError.microphonePermissionDenied
        
    case .undetermined:
        // –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
        let granted = await AVAudioSession.sharedInstance().requestRecordPermission()
        if !granted {
            throw WhisperKitError.microphonePermissionDenied
        }
        
    @unknown default:
        throw WhisperKitError.unknown(underlying: NSError(
            domain: "AVAudioSession",
            code: -1
        ))
    }
}
```

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏:**

```swift
class MemoryMonitor {
    func checkAvailableMemory() throws {
        var info = mach_task_basic_info()
        var count = mach_msg_type_number_t(MemoryLayout<mach_task_basic_info>.size)/4
        
        let kerr: kern_return_t = withUnsafeMutablePointer(to: &info) {
            $0.withMemoryRebound(to: integer_t.self, capacity: 1) {
                task_info(mach_task_self_,
                         task_flavor_t(MACH_TASK_BASIC_INFO),
                         $0,
                         &count)
            }
        }
        
        guard kerr == KERN_SUCCESS else {
            throw WhisperKitError.unknown(underlying: NSError(
                domain: "MemoryMonitor",
                code: Int(kerr)
            ))
        }
        
        let usedMemoryMB = Double(info.resident_size) / 1024.0 / 1024.0
        let totalMemoryGB = ProcessInfo.processInfo.physicalMemory / 1024 / 1024 / 1024
        
        // –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è >80% –ø–∞–º—è—Ç–∏, –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç—å
        let memoryThreshold = Double(totalMemoryGB) * 0.8 * 1024  // –≤ MB
        
        if usedMemoryMB > memoryThreshold {
            throw WhisperKitError.insufficientMemory
        }
    }
}
```

---

## 11. Best Practices

### 11.1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é

**–ü—Ä–∞–≤–∏–ª–∞:**

1. **–û—Å–≤–æ–±–æ–∂–¥–∞—Ç—å WhisperKit –ø—Ä–∏ —É—Ö–æ–¥–µ –≤ background**

```swift
class WhisperKitManager {
    func applicationDidEnterBackground() {
        // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é
        stopTranscription()
        
        // –í—ã–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å –∏–∑ –ø–∞–º—è—Ç–∏
        whisperKit?.unloadModels()
        
        print("‚ôªÔ∏è Models unloaded to free memory")
    }
    
    func applicationWillEnterForeground() async throws {
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å
        try await initialize()
    }
}
```

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å weak references –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è retain cycles**

```swift
class AudioRecordingManager {
    weak var delegate: TranscriptionDelegate?  // ‚¨ÖÔ∏è weak
    
    private func setupCallbacks() {
        streamTranscriber?.onProgress = { [weak self] progress in
            self?.delegate?.didUpdateProgress(progress)
        }
    }
}
```

3. **–û—á–∏—â–∞—Ç—å –∞—É–¥–∏–æ –±—É—Ñ–µ—Ä—ã**

```swift
func stopRecording() {
    audioEngine.stop()
    audioEngine.inputNode.removeTap(onBus: 0)
    
    // –û—á–∏—Å—Ç–∏—Ç—å –±—É—Ñ–µ—Ä—ã
    recordedSamples.removeAll()
    streamTranscriber = nil
}
```

### 11.2. –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å

**–ü—Ä–∞–≤–∏–ª–∞:**

1. **–í—Å–µ UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ main thread**

```swift
DispatchQueue.main.async {
    self.intermediateLabel.text = text
    self.progressView.progress = progress
}
```

2. **Heavy –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞ background**

```swift
Task.detached(priority: .userInitiated) {
    let result = try await whisperKit.transcribe(audioPath: path)
    
    await MainActor.run {
        self.displayResult(result)
    }
}
```

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å actors –¥–ª—è thread-safety (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**

```swift
actor TranscriptionQueue {
    private var queue: [TranscriptionResult] = []
    
    func enqueue(_ result: TranscriptionResult) {
        queue.append(result)
    }
    
    func dequeue() -> TranscriptionResult? {
        queue.isEmpty ? nil : queue.removeFirst()
    }
}
```

### 11.3. Battery optimization

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏:**

1. **–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é –ø—Ä–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏**

```swift
class TranscriptionViewController {
    private var inactivityTimer: Timer?
    
    func startInactivityTimer() {
        inactivityTimer?.invalidate()
        inactivityTimer = Timer.scheduledTimer(
            withTimeInterval: 30.0,  // 30 —Å–µ–∫—É–Ω–¥
            repeats: false
        ) { [weak self] _ in
            self?.handleInactivity()
        }
    }
    
    private func handleInactivity() {
        // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –µ—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        stopRecording()
        showInactivityMessage()
    }
}
```

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É–¥–∏–æ**

```swift
func setupAudioSession() throws {
    let audioSession = AVAudioSession.sharedInstance()
    
    try audioSession.setCategory(
        .record,
        mode: .measurement,  // ‚¨ÖÔ∏è –≠–Ω–µ—Ä–≥–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
        options: []
    )
    
    // –û—Ç–∫–ª—é—á–∏—Ç—å bluetooth –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–µ–Ω
    try audioSession.setPreferredInput(
        audioSession.availableInputs?.first(where: { $0.portType == .builtInMic })
    )
}
```

### 11.4. Permission handling

**Best practice:**

```swift
class PermissionManager {
    func requestMicrophonePermission() async -> Bool {
        let status = AVAudioSession.sharedInstance().recordPermission
        
        switch status {
        case .granted:
            return true
            
        case .denied:
            // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –∫–∞–∫ –≤–∫–ª—é—á–∏—Ç—å
            await showPermissionDeniedInstructions()
            return false
            
        case .undetermined:
            // –ü–æ–∫–∞–∑–∞—Ç—å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ü–ï–†–ï–î –∑–∞–ø—Ä–æ—Å–æ–º
            await showPermissionRationale()
            
            // –ó–∞–ø—Ä–æ—Å–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
            return await AVAudioSession.sharedInstance().requestRecordPermission()
            
        @unknown default:
            return false
        }
    }
    
    @MainActor
    private func showPermissionRationale() async {
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –æ–±—ä—è—Å–Ω—è—é—â–∏–π –∑–∞—á–µ–º –Ω—É–∂–µ–Ω –º–∏–∫—Ä–æ—Ñ–æ–Ω
        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—É–¥–µ—Ç –±–æ–ª–µ–µ —Å–∫–ª–æ–Ω–µ–Ω –¥–∞—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
    }
    
    @MainActor
    private func showPermissionDeniedInstructions() async {
        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é: Settings ‚Üí Privacy ‚Üí Microphone ‚Üí Your App
    }
}
```

### 11.5. UI responsiveness

**–ü—Ä–∞–≤–∏–ª–∞:**

1. **–ù–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å main thread**

```swift
// ‚ùå –ü–õ–û–•–û - –±–ª–æ–∫–∏—Ä—É–µ—Ç UI
let result = try await whisperKit.transcribe(audioPath: path)
updateUI(result)

// ‚úÖ –•–û–†–û–®–û - UI –æ—Å—Ç–∞—ë—Ç—Å—è responsive
Task {
    let result = try await whisperKit.transcribe(audioPath: path)
    await MainActor.run {
        updateUI(result)
    }
}
```

2. **–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å loading –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã**

```swift
func startTranscription() async {
    showLoadingIndicator()
    
    do {
        try await whisperManager.startRealtimeTranscription(delegate: self)
        hideLoadingIndicator()
    } catch {
        hideLoadingIndicator()
        handleError(error)
    }
}
```

3. **Debounce UI updates –¥–ª—è production**

```swift
class DebouncedUpdater {
    private var workItem: DispatchWorkItem?
    private let delay: TimeInterval
    
    init(delay: TimeInterval = 0.3) {
        self.delay = delay
    }
    
    func debounce(_ action: @escaping () -> Void) {
        workItem?.cancel()
        let newWorkItem = DispatchWorkItem(block: action)
        workItem = newWorkItem
        DispatchQueue.main.asyncAfter(deadline: .now() + delay, execute: newWorkItem)
    }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
let updater = DebouncedUpdater(delay: 0.3)

func didReceiveIntermediateResult(_ text: String) {
    updater.debounce {
        self.intermediateLabel.text = text
    }
}
```

---

## 12. –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### 12.1. WhisperKitManager (–ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)

```swift
import Foundation
import WhisperKit
import AVFoundation

class WhisperKitManager {
    // MARK: - Singleton
    static let shared = WhisperKitManager()
    
    // MARK: - Properties
    private var whisperKit: WhisperKit?
    private let modelDownloadManager: ModelDownloadManager
    private let retryManager: RetryManager
    private var audioRecordingManager: AudioRecordingManager?
    private let errorHandler: ErrorHandler
    
    private var isInitialized = false
    
    // MARK: - Initialization
    private init() {
        self.modelDownloadManager = ModelDownloadManager()
        self.retryManager = RetryManager(maxRetries: 3, baseDelay: 1.0)
        self.errorHandler = ErrorHandler()
    }
    
    // MARK: - Public Methods
    
    /// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WhisperKit —Å –º–æ–¥–µ–ª—å—é tiny-en
    func initialize() async throws {
        guard !isInitialized else {
            print("‚úÖ WhisperKit already initialized")
            return
        }
        
        try await retryManager.retry {
            // 1. –°–∫–∞—á–∞—Ç—å –º–æ–¥–µ–ª—å –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            print("üì• Downloading model if needed...")
            try await modelDownloadManager.downloadModelIfNeeded()
            
            // 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
            let config = createConfig()
            
            // 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å WhisperKit
            print("üöÄ Initializing WhisperKit...")
            self.whisperKit = try await WhisperKit(config)
            
            self.isInitialized = true
            print("‚úÖ WhisperKit initialized successfully")
        }
    }
    
    /// –ù–∞—á–∞—Ç—å real-time —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é
    func startRealtimeTranscription(delegate: TranscriptionDelegate) throws {
        guard isInitialized, let whisperKit = whisperKit else {
            throw WhisperKitError.notInitialized
        }
        
        // –°–æ–∑–¥–∞—Ç—å audio recording manager –µ—Å–ª–∏ –Ω–µ—Ç
        if audioRecordingManager == nil {
            audioRecordingManager = AudioRecordingManager()
        }
        
        // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å decoding options
        let decodingOptions = createDecodingOptions(delegate: delegate)
        
        // –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å
        try audioRecordingManager?.startRecording(
            whisperKit: whisperKit,
            decodingOptions: decodingOptions,
            delegate: delegate
        )
    }
    
    /// –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é
    func stopTranscription() {
        audioRecordingManager?.stopRecording()
    }
    
    /// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å
    func isReady() -> Bool {
        return isInitialized && whisperKit != nil
    }
    
    /// –í—ã–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å (–¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏)
    func unloadModels() {
        whisperKit?.unloadModels()
        isInitialized = false
        print("‚ôªÔ∏è Models unloaded")
    }
    
    // MARK: - Private Methods
    
    private func createConfig() -> WhisperKitConfig {
        var config = WhisperKitConfig(
            model: "tiny-en",
            verbose: false,
            download: true,
            prewarm: true,
            load: true,
            modelFolder: modelDownloadManager.getCachePath()
        )
        
        // –ù–∞—Å—Ç—Ä–æ–∏—Ç—å compute options –¥–ª—è Neural Engine
        var computeOptions = ModelComputeOptions()
        computeOptions.audioEncoderCompute = .neuralEngine
        computeOptions.textDecoderCompute = .neuralEngine
        config.computeOptions = computeOptions
        
        return config
    }
    
    private func createDecodingOptions(delegate: TranscriptionDelegate) -> DecodingOptions {
        var options = DecodingOptions()
        
        // –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        options.language = "en"
        options.task = .transcribe
        options.temperature = 0.0
        options.wordTimestamps = true
        options.detectLanguage = true
        
        // –ö–æ–ª–±—ç–∫–∏
        options.progressCallback = { progress in
            DispatchQueue.main.async {
                delegate.didUpdateProgress(Float(progress.fractionCompleted))
            }
        }
        
        options.segmentCallback = { segments in
            DispatchQueue.main.async {
                let text = segments.map { $0.text }.joined()
                delegate.didReceiveIntermediateResult(text)
            }
        }
        
        return options
    }
}

// MARK: - Errors
enum WhisperKitError: Error {
    case notInitialized
    case modelNotFound
    case modelDownloadFailed(underlying: Error)
    case modelLoadingFailed(underlying: Error)
    case audioProcessingFailed(underlying: Error)
    case transcriptionFailed(underlying: Error)
    case microphonePermissionDenied
    case audioSessionFailed(underlying: Error)
    case insufficientMemory
    case unsupportedDevice
    case networkError(underlying: Error)
    case unknown(underlying: Error)
}
```

### 12.2. TranscriptionViewController (UIKit)

```swift
import UIKit

class TranscriptionViewController: UIViewController {
    // MARK: - UI Components
    private let intermediateLabel: UILabel = {
        let label = UILabel()
        label.numberOfLines = 0
        label.font = .systemFont(ofSize: 16, weight: .regular)
        label.textColor = .secondaryLabel
        label.textAlignment = .center
        label.text = "Tap the button and start speaking..."
        label.translatesAutoresizingMaskIntoConstraints = false
        return label
    }()
    
    private let finalTextView: UITextView = {
        let textView = UITextView()
        textView.font = .systemFont(ofSize: 18, weight: .medium)
        textView.textColor = .label
        textView.isEditable = false
        textView.backgroundColor = .systemGray6
        textView.layer.cornerRadius = 12
        textView.textContainerInset = UIEdgeInsets(top: 16, left: 16, bottom: 16, right: 16)
        textView.translatesAutoresizingMaskIntoConstraints = false
        return textView
    }()
    
    private let recordButton: UIButton = {
        let button = UIButton(type: .system)
        button.setTitle("Start Recording", for: .normal)
        button.setTitle("Stop Recording", for: .selected)
        button.titleLabel?.font = .systemFont(ofSize: 18, weight: .semibold)
        button.backgroundColor = .systemBlue
        button.setTitleColor(.white, for: .normal)
        button.layer.cornerRadius = 12
        button.translatesAutoresizingMaskIntoConstraints = false
        return button
    }()
    
    private let statusLabel: UILabel = {
        let label = UILabel()
        label.font = .systemFont(ofSize: 14, weight: .regular)
        label.textColor = .secondaryLabel
        label.textAlignment = .center
        label.text = "Ready"
        label.translatesAutoresizingMaskIntoConstraints = false
        return label
    }()
    
    private let progressView: UIProgressView = {
        let progress = UIProgressView(progressViewStyle: .default)
        progress.progress = 0.0
        progress.translatesAutoresizingMaskIntoConstraints = false
        return progress
    }()
    
    private let activityIndicator: UIActivityIndicatorView = {
        let indicator = UIActivityIndicatorView(style: .large)
        indicator.hidesWhenStopped = true
        indicator.translatesAutoresizingMaskIntoConstraints = false
        return indicator
    }()
    
    // MARK: - Properties
    private let whisperManager = WhisperKitManager.shared
    private let errorHandler = ErrorHandler()
    private let languageDetector = LanguageDetector()
    private var isRecording = false
    
    // MARK: - Lifecycle
    override func viewDidLoad() {
        super.viewDidLoad()
        
        title = "Voice Transcription"
        view.backgroundColor = .systemBackground
        
        setupUI()
        setupConstraints()
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å WhisperKit
        initializeWhisperKit()
    }
    
    // MARK: - Setup
    private func setupUI() {
        view.addSubview(statusLabel)
        view.addSubview(intermediateLabel)
        view.addSubview(finalTextView)
        view.addSubview(recordButton)
        view.addSubview(progressView)
        view.addSubview(activityIndicator)
        
        recordButton.addTarget(
            self,
            action: #selector(handleRecordButtonTap),
            for: .touchUpInside
        )
        
        errorHandler.viewController = self
    }
    
    private func setupConstraints() {
        NSLayoutConstraint.activate([
            // Status label
            statusLabel.topAnchor.constraint(equalTo: view.safeAreaLayoutGuide.topAnchor, constant: 20),
            statusLabel.leadingAnchor.constraint(equalTo: view.leadingAnchor, constant: 20),
            statusLabel.trailingAnchor.constraint(equalTo: view.trailingAnchor, constant: -20),
            
            // Progress view
            progressView.topAnchor.constraint(equalTo: statusLabel.bottomAnchor, constant: 10),
            progressView.leadingAnchor.constraint(equalTo: view.leadingAnchor, constant: 20),
            progressView.trailingAnchor.constraint(equalTo: view.trailingAnchor, constant: -20),
            
            // Intermediate label
            intermediateLabel.topAnchor.constraint(equalTo: progressView.bottomAnchor, constant: 30),
            intermediateLabel.leadingAnchor.constraint(equalTo: view.leadingAnchor, constant: 20),
            intermediateLabel.trailingAnchor.constraint(equalTo: view.trailingAnchor, constant: -20),
            intermediateLabel.heightAnchor.constraint(greaterThanOrEqualToConstant: 60),
            
            // Final text view
            finalTextView.topAnchor.constraint(equalTo: intermediateLabel.bottomAnchor, constant: 20),
            finalTextView.leadingAnchor.constraint(equalTo: view.leadingAnchor, constant: 20),
            finalTextView.trailingAnchor.constraint(equalTo: view.trailingAnchor, constant: -20),
            finalTextView.bottomAnchor.constraint(equalTo: recordButton.topAnchor, constant: -20),
            
            // Record button
            recordButton.leadingAnchor.constraint(equalTo: view.leadingAnchor, constant: 20),
            recordButton.trailingAnchor.constraint(equalTo: view.trailingAnchor, constant: -20),
            recordButton.bottomAnchor.constraint(equalTo: view.safeAreaLayoutGuide.bottomAnchor, constant: -20),
            recordButton.heightAnchor.constraint(equalToConstant: 56),
            
            // Activity indicator
            activityIndicator.centerXAnchor.constraint(equalTo: view.centerXAnchor),
            activityIndicator.centerYAnchor.constraint(equalTo: view.centerYAnchor)
        ])
    }
    
    // MARK: - Actions
    @objc private func handleRecordButtonTap() {
        if isRecording {
            stopRecording()
        } else {
            startRecording()
        }
    }
    
    private func initializeWhisperKit() {
        activityIndicator.startAnimating()
        statusLabel.text = "Initializing..."
        recordButton.isEnabled = false
        
        Task {
            do {
                try await whisperManager.initialize()
                
                await MainActor.run {
                    activityIndicator.stopAnimating()
                    statusLabel.text = "Ready"
                    recordButton.isEnabled = true
                }
            } catch {
                await MainActor.run {
                    activityIndicator.stopAnimating()
                    statusLabel.text = "Initialization failed"
                    errorHandler.handle(error)
                }
            }
        }
    }
    
    private func startRecording() {
        Task {
            do {
                // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω
                try await checkMicrophonePermission()
                
                // –ù–∞—á–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é
                try whisperManager.startRealtimeTranscription(delegate: self)
                
                await MainActor.run {
                    isRecording = true
                    recordButton.isSelected = true
                    recordButton.backgroundColor = .systemRed
                    statusLabel.text = "Recording..."
                    statusLabel.textColor = .systemRed
                }
            } catch {
                await MainActor.run {
                    errorHandler.handle(error)
                }
            }
        }
    }
    
    private func stopRecording() {
        whisperManager.stopTranscription()
        
        isRecording = false
        recordButton.isSelected = false
        recordButton.backgroundColor = .systemBlue
        statusLabel.text = "Ready"
        statusLabel.textColor = .secondaryLabel
        intermediateLabel.text = ""
    }
    
    private func checkMicrophonePermission() async throws {
        let status = AVAudioSession.sharedInstance().recordPermission
        
        switch status {
        case .granted:
            return
        case .denied:
            throw WhisperKitError.microphonePermissionDenied
        case .undetermined:
            let granted = await AVAudioSession.sharedInstance().requestRecordPermission()
            if !granted {
                throw WhisperKitError.microphonePermissionDenied
            }
        @unknown default:
            throw WhisperKitError.unknown(underlying: NSError(domain: "Permission", code: -1))
        }
    }
}

// MARK: - TranscriptionDelegate
extension TranscriptionViewController: TranscriptionDelegate {
    func didReceiveIntermediateResult(_ text: String) {
        intermediateLabel.text = text
        intermediateLabel.alpha = 0.7
    }
    
    func didReceiveFinalResult(_ text: String) {
        let currentText = finalTextView.text ?? ""
        let timestamp = Date().formatted(date: .omitted, time: .shortened)
        let newText = currentText.isEmpty 
            ? "[\(timestamp)] \(text)" 
            : "\(currentText)\n\n[\(timestamp)] \(text)"
        
        finalTextView.text = newText
        intermediateLabel.text = ""
        
        // Scroll to bottom
        let bottom = NSRange(location: finalTextView.text.count - 1, length: 1)
        finalTextView.scrollRangeToVisible(bottom)
    }
    
    func didUpdateProgress(_ progress: Float) {
        progressView.progress = progress
    }
    
    func didEncounterError(_ error: Error) {
        errorHandler.handle(error)
        stopRecording()
    }
    
    func didDetectNonEnglishSpeech() {
        showLanguageWarning()
    }
    
    private func showLanguageWarning() {
        let alert = UIAlertController(
            title: "English Only",
            message: "Please speak English. This model is optimized for English language only.",
            preferredStyle: .alert
        )
        alert.addAction(UIAlertAction(title: "OK", style: .default))
        present(alert, animated: true)
    }
}

// MARK: - TranscriptionDelegate Protocol
protocol TranscriptionDelegate: AnyObject {
    func didReceiveIntermediateResult(_ text: String)
    func didReceiveFinalResult(_ text: String)
    func didUpdateProgress(_ progress: Float)
    func didEncounterError(_ error: Error)
    func didDetectNonEnglishSpeech()
}
```

### 12.3. ModelDownloadManager

```swift
import Foundation

class ModelDownloadManager {
    private let modelName = "tiny-en"
    private let fileManager = FileManager.default
    
    /// –°–∫–∞—á–∞—Ç—å –º–æ–¥–µ–ª—å –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç –≤ –∫—ç—à–µ
    func downloadModelIfNeeded() async throws {
        if hasCachedModel() {
            print("‚úÖ Model already cached")
            return
        }
        
        print("üì• Downloading model '\(modelName)'...")
        
        // WhisperKit –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∞–µ—Ç –º–æ–¥–µ–ª—å –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        // —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º download: true
        
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É:
        // - –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
        // - –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–∫–∞—á–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
        // - Fallback –Ω–∞ –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å –µ—Å–ª–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å
    }
    
    /// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
    func hasCachedModel() -> Bool {
        let cachePath = getCachePath()
        return fileManager.fileExists(atPath: cachePath.path)
    }
    
    /// –ü–æ–ª—É—á–∏—Ç—å –ø—É—Ç—å –∫ –∫—ç—à—É –º–æ–¥–µ–ª–µ–π
    func getCachePath() -> URL {
        let documentsPath = fileManager
            .urls(for: .documentDirectory, in: .userDomainMask)[0]
        
        return documentsPath
            .appendingPathComponent("whisperkit_models")
            .appendingPathComponent(modelName)
    }
    
    /// –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –º–æ–¥–µ–ª–µ–π
    func clearCache() throws {
        let cachePath = getCachePath()
        
        if fileManager.fileExists(atPath: cachePath.path) {
            try fileManager.removeItem(at: cachePath)
            print("üóëÔ∏è Cache cleared")
        }
    }
    
    /// –ü–æ–ª—É—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞
    func getCacheSize() -> Int64 {
        let cachePath = getCachePath()
        
        guard let enumerator = fileManager.enumerator(
            at: cachePath,
            includingPropertiesForKeys: [.fileSizeKey]
        ) else {
            return 0
        }
        
        var totalSize: Int64 = 0
        
        for case let fileURL as URL in enumerator {
            guard let resourceValues = try? fileURL.resourceValues(forKeys: [.fileSizeKey]),
                  let fileSize = resourceValues.fileSize else {
                continue
            }
            totalSize += Int64(fileSize)
        }
        
        return totalSize
    }
    
    /// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    func formattedCacheSize() -> String {
        let size = getCacheSize()
        let formatter = ByteCountFormatter()
        formatter.allowedUnits = [.useMB, .useGB]
        formatter.countStyle = .file
        return formatter.string(fromByteCount: size)
    }
}
```

---

## 13. –ß–µ–∫-–ª–∏—Å—Ç –∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏

### 13.1. –ß–µ–∫-–ª–∏—Å—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

#### –§–∞–∑–∞ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å WhisperKit —á–µ—Ä–µ–∑ SPM (–≤–µ—Ä—Å–∏—è 0.14.0+)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Info.plist (–º–∏–∫—Ä–æ—Ñ–æ–Ω permission)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é iOS 16.0
- [ ] –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞

#### –§–∞–∑–∞ 2: –ë–∞–∑–æ–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å WhisperKitManager (singleton)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ModelDownloadManager
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è tiny-en –º–æ–¥–µ–ª–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å ModelComputeOptions –¥–ª—è Neural Engine
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ

#### –§–∞–∑–∞ 3: Real-time —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å AudioRecordingManager
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å AVAudioEngine
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å audio buffer processing
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å AudioStreamTranscriber
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–ª–±—ç–∫–∏ (progress, segments)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å resampling –¥–æ 16kHz

#### –§–∞–∑–∞ 4: UI (UIKit)
- [ ] –°–æ–∑–¥–∞—Ç—å TranscriptionViewController
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å layout (Auto Layout)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (UILabel)
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (UITextView)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –∑–∞–ø–∏—Å–∏ (UIButton)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (UIProgressView)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ (UIActivityIndicatorView)

#### –§–∞–∑–∞ 5: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å LanguageDetector
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å detectLanguage –≤ DecodingOptions
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å UI –∞–ª–µ—Ä—Ç –¥–ª—è –Ω–µ–∞–Ω–≥–ª–∏–π—Å–∫–æ–π —Ä–µ—á–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–∞—Ö

#### –§–∞–∑–∞ 6: Retry –º–µ—Ö–∞–Ω–∏–∑–º
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å RetryManager
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å retry –≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å retry –≤ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å UI –∏–Ω–¥–∏–∫–∞—Ü–∏—é retry

#### –§–∞–∑–∞ 7: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å enum WhisperKitError
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ErrorHandler
- [ ] –ú–∞–ø–ø–∏–Ω–≥ –æ—à–∏–±–æ–∫ –Ω–∞ user-friendly —Å–æ–æ–±—â–µ–Ω–∏—è
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å recovery actions
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –æ—à–∏–±–æ–∫

#### –§–∞–∑–∞ 8: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—ã–≥—Ä—É–∑–∫—É –º–æ–¥–µ–ª–µ–π –ø—Ä–∏ background
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–º—è—Ç–∏
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å audio session –¥–ª—è –±–∞—Ç–∞—Ä–µ–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å debouncing –¥–ª—è UI updates
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è

#### –§–∞–∑–∞ 9: Best Practices
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ weak references
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ UI updates –Ω–∞ main thread
- [ ] –î–æ–±–∞–≤–∏—Ç—å haptic feedback
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å permission flow
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (debug/production)

#### –§–∞–∑–∞ 10: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è WhisperKitManager
- [ ] Unit —Ç–µ—Å—Ç—ã –¥–ª—è RetryManager
- [ ] UI —Ç–µ—Å—Ç—ã –¥–ª—è TranscriptionViewController
- [ ] –¢–µ—Å—Ç—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö (iPhone 11, 12, 13, 14, 15)
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –¢–µ—Å—Ç—ã –ø–∞–º—è—Ç–∏ (Memory Graph)

### 13.2. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

| ‚Ññ | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –ö—Ä–∏—Ç–µ—Ä–∏–π |
|---|------------|----------|
| 1 | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WhisperKit | –ú–æ–¥–µ–ª—å `tiny-en` –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∑–∞ <5 —Å–µ–∫—É–Ω–¥ –Ω–∞ iPhone 12+ |
| 2 | Real-time —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è | –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 1-2 —Å–µ–∫—É–Ω–¥—ã |
| 3 | –¢–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è | >85% —Ç–æ—á–Ω–æ—Å—Ç–∏ –Ω–∞ —á–∏—Å—Ç–æ–π –∞–Ω–≥–ª–∏–π—Å–∫–æ–π —Ä–µ—á–∏ |
| 4 | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ | –î–µ—Ç–µ–∫—Ü–∏—è –Ω–µ–∞–Ω–≥–ª–∏–π—Å–∫–æ–π —Ä–µ—á–∏ —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é >90% |
| 5 | Retry –º–µ—Ö–∞–Ω–∏–∑–º | –£—Å–ø–µ—à–Ω—ã–π retry –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö —Å–µ—Ç–∏/–ø–∞–º—è—Ç–∏ |
| 6 | –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ | –í—Å–µ –æ—à–∏–±–∫–∏ –∏–º–µ—é—Ç –ø–æ–Ω—è—Ç–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏—è |
| 7 | UI responsiveness | UI –Ω–µ –∑–∞–º–µ—Ä–∑–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ |
| 8 | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ | –ú–æ–¥–µ–ª—å —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ |
| 9 | Neural Engine | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Neural Engine –Ω–∞ iPhone —Å A12+ |
| 10 | Offline —Ä–∞–±–æ—Ç–∞ | –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è |

#### –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

| ‚Ññ | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –ö—Ä–∏—Ç–µ—Ä–∏–π |
|---|------------|----------|
| 1 | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –≤ real-time –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫ |
| 2 | –ü–∞–º—è—Ç—å | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ <200MB RAM –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ |
| 3 | –ë–∞—Ç–∞—Ä–µ—è | <10% –±–∞—Ç–∞—Ä–µ–∏ –≤ —á–∞—Å –ø—Ä–∏ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ |
| 4 | –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å | –ù–µ—Ç –∫—Ä–∞—à–µ–π –ø—Ä–∏ 30-–º–∏–Ω—É—Ç–Ω–æ–π –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π —Ä–∞–±–æ—Ç–µ |
| 5 | –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ | SwiftLint warnings = 0, code coverage >70% |
| 6 | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | –í—Å–µ public –º–µ—Ç–æ–¥—ã –∏–º–µ—é—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ |
| 7 | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | –†–∞–±–æ—Ç–∞ –Ω–∞ iOS 16.0 - 18.x |
| 8 | Accessibility | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ VoiceOver –∏ Dynamic Type |

### 13.3. –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –î–æ–∂–¥–∞—Ç—å—Å—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –º–æ–¥–µ–ª—å —Å–∫–∞—á–∞–ª–∞—Å—å, UI –≥–æ—Ç–æ–≤
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –º–æ–¥–µ–ª—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∞ –≤ Documents

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: Real-time —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è
1. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "Start Recording"
2. –†–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É
3. –ù–∞—á–∞—Ç—å –≥–æ–≤–æ—Ä–∏—Ç—å –ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è
5. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ù–µ–∞–Ω–≥–ª–∏–π—Å–∫–∞—è —Ä–µ—á—å
1. –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å
2. –ì–æ–≤–æ—Ä–∏—Ç—å –Ω–∞ —Ä—É—Å—Å–∫–æ–º/–∏—Å–ø–∞–Ω—Å–∫–æ–º/—Ñ—Ä–∞–Ω—Ü—É–∑—Å–∫–æ–º
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∞–ª–µ—Ä—Ç "Please speak English"
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –≤—Å—ë —Ä–∞–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç)

#### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ (–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)
1. –û—Ç–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –∞–ª–µ—Ä—Ç "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É"
4. –í–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
5. –ù–∞–∂–∞—Ç—å "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å"
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –º–æ–¥–µ–ª—å —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ

#### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –†–∞–±–æ—Ç–∞ –≤ background
1. –ù–∞—á–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é
2. –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ background
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å
4. –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ foreground
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –º–æ–¥–µ–ª—å –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω–∞, –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å

#### –°—Ü–µ–Ω–∞—Ä–∏–π 6: –ù–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–Ω–æ–≥–æ –¥—Ä—É–≥–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
2. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –Ω–∞—á–∞—Ç—å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—é
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –∞–ª–µ—Ä—Ç "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏"
4. –ó–∞–∫—Ä—ã—Ç—å –¥—Ä—É–≥–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
5. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç

### 13.4. –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### –ò–∑–º–µ—Ä–µ–Ω–∏—è –Ω–∞ iPhone 12 Pro

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –ú–µ—Ç–æ–¥ –∏–∑–º–µ—Ä–µ–Ω–∏—è |
|---------|------------------|-----------------|
| –í—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫) | <10 —Å–µ–∫—É–Ω–¥ | –ó–∞–º–µ—Ä –æ—Ç launch –¥–æ "Ready" |
| –í—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π) | <3 —Å–µ–∫—É–Ω–¥—ã | –ó–∞–º–µ—Ä –æ—Ç launch –¥–æ "Ready" |
| Latency —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ | <500ms | –í—Ä–µ–º—è –æ—Ç —Ä–µ—á–∏ –¥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ RAM | <200MB | Instruments Memory Graph |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU | <30% | Instruments CPU Profiler |
| –ë–∞—Ç–∞—Ä–µ—è (30 –º–∏–Ω —Ä–∞–±–æ—Ç—ã) | <5% | Instruments Energy Log |
| –†–∞–∑–º–µ—Ä –∫—ç—à–∞ –º–æ–¥–µ–ª–∏ | ~40MB | File Manager |
| FPS UI –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã | 60 FPS | Instruments Core Animation |

### 13.5. –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∞–≥–∏ (–±–ª–æ–∫–∏—Ä—É—é—Ç —Ä–µ–ª–∏–∑)

- ‚ùå –ö—Ä–∞—à –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚ùå –ö—Ä–∞—à –ø—Ä–∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
- ‚ùå –£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ (memory leaks)
- ‚ùå UI –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –Ω–∞ >1 —Å–µ–∫—É–Ω–¥—É
- ‚ùå –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- ‚ùå –ú–æ–¥–µ–ª—å –Ω–µ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è / –Ω–µ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è
- ‚ùå –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç–∫–∞–∑–∞ –≤ –¥–æ—Å—Ç—É–ø–µ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É

### 13.6. –ù–µ–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∞–≥–∏ (–º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å)

- ‚ö†Ô∏è –ó–∞–¥–µ—Ä–∂–∫–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ >1 —Å–µ–∫—É–Ω–¥—ã
- ‚ö†Ô∏è –ù–µ—Ç–æ—á–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Å —Å–∏–ª—å–Ω—ã–º –∞–∫—Ü–µ–Ω—Ç–æ–º
- ‚ö†Ô∏è UI –≥–ª—é–∫–∏ –Ω–∞ iOS 16.0 (–µ—Å–ª–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 16.1+)
- ‚ö†Ô∏è –î–µ—Ç–µ–∫—Ü–∏—è —è–∑—ã–∫–∞ –æ—à–∏–±–∞–µ—Ç—Å—è –≤ <10% —Å–ª—É—á–∞–µ–≤
- ‚ö†Ô∏è Retry —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–µ –≤—Å–µ–≥–¥–∞

---

## –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### A. –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [WhisperKit GitHub](https://github.com/argmaxinc/WhisperKit)
- [WhisperKit Documentation](https://swiftpackageindex.com/argmaxinc/WhisperKit)
- [–ú–æ–¥–µ–ª–∏ –Ω–∞ HuggingFace](https://huggingface.co/argmaxinc/whisperkit-coreml)
- [Apple CoreML Documentation](https://developer.apple.com/documentation/coreml)
- [AVFoundation Guide](https://developer.apple.com/documentation/avfoundation)

### B. –ö–æ–Ω—Ç–∞–∫—Ç—ã

- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:** [–í–∞—à email]
- **–í–æ–ø—Ä–æ—Å—ã –ø–æ –¢–ó:** [–í–∞—à email]
- **–°—Ä–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** [–£–∫–∞–∑–∞—Ç—å –¥–µ–¥–ª–∞–π–Ω]

---

**–ö–æ–Ω–µ—Ü —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è**

*–í–µ—Ä—Å–∏—è 1.0 –æ—Ç 18 –æ–∫—Ç—è–±—Ä—è 2025*
